# Repeat Buyer Prediction for E-Commerce
## 抽象
在促销期间，商家经常会收购大量新买家。然而，许多被吸引的买家都是一次性交易猎人，促销可能对销售产生很小的持久影响。对于商家而言，重要的是确定谁可以转换为常规忠诚购买者，然后针对他们降低促销成本并提高投资回报率（ROI）。在2015年国际人工智能联合会议（IJCAI）上，阿里巴巴根据2014年在天猫网举办的“双11”购物活动的销售数据，举办了一场重复买家预测的国际竞赛。在753支球队中，我们在第一阶段的比赛中获得了第一名。在本文中，我们提出了我们的成功解决方案，其中包括全面的特征工程和模型培训。我们通过广泛的功能工程为用户，商家，品牌，类别，商品及其互动创建了专业文件。这些专业文件不仅可用于此特定预测任务，还可用于电子商务中的其他重要任务，例如客户细分，产品推荐和品牌的客户群增强。特征工程通常是预测任务成功的最重要因素，但在电子商务预测任务的特征工程文献中找不到太多工作。我们的工作为电子商务中的数据科学从业者提供了一些有用的提示和见解。
## 关键词
重复买方预测; 特色工程; 电子商务
## 1.引言
大型企业对消费者（B2C）电子商务网站，如亚马逊和阿里巴巴，经常在黑色星期五和双十一（单身节）等特殊日子举行全国性的促销活动。 商家在这些活动期间获得新客户。 然而，大多数新客户都是一次性交易猎人，对他们的促销通常不会产生商家预期的投资回报率（ROI）。            
因此，商家需要从这些新客户中识别潜在的忠诚的商家，以便对他们进行有针对性的广告（和促销）以降低促销成本。 任何个体商家都难以识别其潜在的忠诚客户，因为它几乎没有关于其新客户的信息。 相反，B2C电子商务网站拥有其平台上所有商家的所有客户的点击流数据和购买历史。 因此，他们可以从历史数据中了解新客户的偏好和习惯，然后预测新客户再次从同一商家购买的可能性。                        
在IJCAI 2015上，阿里巴巴根据2014年“双十一”日的销售数据，在中国最大的B2C平台天猫网上举办了一场重复买家预测的国际竞赛1。 双11是中国最大的网上购物活动，2013年销售额（天猫和淘宝）达到58亿美元，2014年达到93亿美元，2015年达到143亿美元。提供给竞争对手的数据包括一些商家和 他们在活动期间获得的新买家，以及活动前六个月的用户活动日志数据。 任务是预测给定商家的哪些新客户将在六个月内再次从同一商家购买商品。 这些新买家被称为相应商家的重复买家。                              
我们在比赛的第一阶段赢得了第一名。 我们的成功解决方案包括全面的功能工程和模型培训。 特别是，我们生成了各种类型的功能来描述用户，商家，品牌，类别，项目及其相互作用的不同方面。 我们已经训练了各种分类模型，包括分解机[14,11]，Logistic回归[1,2]，随机森林[5]，GBM [10]和XGBoost [6]。 我们还使用集成技术将多个分类器混合在一起，以进一步提高性能。                       
重复购买者预测问题可以被表述为典型的分类问题，正如大多数竞争参与者所做的那样。这项任务的模型训练与其他分类任务的模型训练差别不大。相反，特征工程是将此任务与其他任务区分开来的主要组件。特征工程是数据科学不可或缺的一部分，通常是机器学习项目成功的关键。它可能比学习更困难，因为它是领域特定的，而机器学习算法主要是通用的。很多试验和错误都可以用于特征设计，并且它通常是机器学习项目中的大部分效果[8]。虽然已经在研究界提出并研究了数以千计的分类算法，但是在电子商务中预测任务的特征工程方面报道的工作并不多。因此，在本文中，我们关注特征工程。我们将描述如何从用户活动日志数据生成各种类型的功能，并通过大量实验研究这些功能的重要性。我们生成的功能可用于各种电子商务应用程序，例如客户细分，产品推荐和品牌客户群增强。我们希望我们的工作对数据科学从业者有价值，他们需要为电子商务中的预测任务开发解决方案。本文的其余部分安排如下。第2节给出了问题描述。第3节描述了我们生成的功能。第4节中描述了模型集合。在第5节中，研究了特征的重要性并列出了顶级特征。最后，第6节总结了论文。
## 2.问题描述
对于重复购买者预测竞赛，提供如图1顶部所示的以下数据：用户的人口统计信息，“双11”促销之前六个月的用户活动日志数据，以及培训和测试新的买家，商品对，从商家第一次购买新买家是在“双11”促销。用户人口统计数据包含用户的年龄和性别。年龄值分为七个范围。培训重新购买者，商品对的类别标签是已知的，并且它指示新购买者是否在“双11”促销之后的六个月内再次从商家购买商品。测试hnew买家，商品对的类标签是隐藏的。任务是预测测试对的类标签。比赛分两个阶段进行。在第1阶段，所有数据都发布给参赛者，除了在第1阶段之后发布的测试对的类别标签。第2阶段在阿里巴巴的云平台上运行以获取更大的数据，并且数据未发布。因此，在本文中，我们关注第1阶段的数据。      
表1显示了培训和测试数据的统计数据。 除了单个商家之外，培训数据中的商家集和测试数据中的商家集是相同的。 训练和测试数据中的用户没有重叠。 最后一列是积极的新买家，商品对的数量，以便新买家在六个月内再次从商家购买商品。 最后一列是这种正对的百分比。 正对的百分比约为6％，这表明大多数新买家确实是一次性交易猎人。           
用户活动日志数据包含以下字段：用户ID，商家ID，项目ID，cat id，品牌ID，操作类型和时间戳。操作类型有四个值：0表示点击，1表示添加到购物车，2表示购买，3表示添加到收藏夹。即使产品完全相同，在不同商家销售的产品也会被分配不同的商品ID。表2显示了用户活动日志数据的统计信息。日志数据中的许多商家在培训或测试数据中没有新买家。它们包含在日志数据中，因为一些新买家访问了它们。这些商家的新买家的活动是用于推断新买家的偏好和习惯的有价值的信息。表3显示了四种类型的操作的数量。大多数操作都是点击。 addto-cart操作的数量非常少，因此我们将添加到购物车的操作与点击操作合并。在该竞赛中提供的用户活动日志数据在电子商务预测任务中是非常典型的。但是，日志数据的形式不适合学习。我们需要从中构建新功能，然后将新功能与训练和测试数据结合起来。在下一节中，我们将介绍如何执行此操作。
## 3.特征工程
用户活动日志数据包含五个实体：用户，商家，品牌，类别和项目。 这些实体的特征及其相互作用可以预测类标签。 例如，用户更有可能从销售零食的商家再次购买，而不是在六个月内从销售电子产品的商家购买，因为零食比电子产品更便宜且消费更快。 我们生成了大量的特征来描述五种类型的实体及其成对交互的特征。 在本节的其余部分中，我们首先概述所有生成的功能，然后详细描述功能。
### 3.1 功能和专业概述
我们生成的功能范围从基本计数到复杂功能，如相似性得分，趋势，PCA（主成分分析）和LDA（潜在Dirichlet分配）功能。 实体的所有特征构成了实体的特征。 我们有五个实体配置文件和五个交互配置文件，如图1底部所示。表4总结了这些配置文件中包含的功能类型。 用户 - 商家交互是五个成对交互配置文件中最重要的交互，因为任务是预测用户是否将返回商家再次购买。 因此，用户 - 商家专业包含比其他交互专业更多的功能。       
原始培训/测试数据仅包含用户ID和商家ID，如图1顶部所示。我们通过添加年龄范围和用户性别，项目ID，品牌ID和类别ID来扩展培训/测试数据，如 图1的中间，其中item id是用户在Double 11天从商家购买的商品的ID，品牌ID和类别ID是商品的品牌和类别。 如果用户在Double 11天从商家购买了多个商品，则使用最常用的商品。 这些功能与扩展的培训/测试数据相结合，如下所示：实体功能基于各自的ID加入; 年龄相关的特征由相应的实体ID和年龄范围加入; 性别相关的特征由相应的实体ID和性别加入; 交互功能由所涉及的两个实体ID连接在一起。
### 3.2 计数/比率功能
在2014年5月12日至2014年11月11日的六个月期间，每个实体都有三种类型的操作 - 点击，购买和添加到收藏夹。图2显示了示例实体的操作历史记录。这三种动作用绿色圆圈表示。行动计数，行动比率和日数。行动计数是每个月（每月计数）或整个数据期间（总计数）的点击次数，购买次数，添加到收藏的行动次数。计数功能是生成更复杂功能的基础。对于图2所示的实体，每月点击次数为（1,1,1,2,1,3,3），每月购买次数为（0,1,0,0,0,0,1），每月添加到收藏的计数是（0,0,0,0,1,1,0）。点击，购买和添加到收藏夹的总计数分别为12,2和2。行动比率是特定行动类型相对于所有行动类型的比例，可以在每个月或整个数据期间计算。对于图2中的实体，整体点击率为12 /（12 + 2 + 2）= 0.75，并且六月点击率为1 /（1 + 1 + 0）= 0.5。             
日计数是每个月或整个数据期间具有特定操作类型的天数。日计数功能主要用于区分偶尔买家的常规买家。例如，在一天内有10次购买行为的用户与另一个用户不同，这些用户的购买行为数量相同，分布在10天不同的日子。后一个用户被认为是比前者更常规的买家。还可以为实体对生成动作计数，动作比率和日计数特征。例如，对于每个用户，商品对，每月点击次数是用户在每个月点击商家的某些项目的次数。对于hmerchant，brandi对，整体购买数量是在整个数据期间从商家购买品牌产品的次数。并非所有月度功能都直接使用，否则会有太多功能。相反，我们使用这些功能来生成更复杂的功能，如月汇聚功能和趋势功能，如稍后所述。产品多样化功能。对于用户，产品多样性功能是用户在每个月或整个数据期间点击，购买或添加到收藏夹的唯一项目，品牌和类别的数量。对于商家而言，产品多样性功能以类似的方式定义。对于商品对，产品多样性功能是用户在每个月或整个数据期间点击，购买或添加到收藏夹的商家的唯一商品，品牌和类别的数量。产品多样性特征背后的直觉是，如果用户对商家的更多项目感兴趣，则用户更有可能再次从商家购买（参见图6（a），7（d）和7（i）） 。渗透功能。项目的渗透功能定义为在给定时间间隔内购买该项目的用户数量。我们还计算了商家，品牌和类别的渗透功能。大客户群通常表明该实体具有良好的声誉，因此用户更有可能回来。
### 3.3聚合功能
每月汇总功能包括月度行动计数的平均值，标准差，最大值和中位数，每月日计数，每月产品多样性计数和每月渗透计数。                       
用户聚合功能是针对商家，品牌，类别，hmerchant，brandi对和hmerchant，categoryi对计算的。 通过首先计算每个用户从商家购买商品的天数，然后计算商家的所有用户的平均值，标准差，最大值和中值来计算商家的用户购买日聚合特征。。 商家的用户购买项目聚合特征以与每个用户从商家购买的唯一商品的数量类似的方式定义。 对于click和addto-favorite操作，用户 - action-day-aggregation和useraction-item-aggregation功能以相同的方式为商家计算。 对于其他实体，仅考虑购买行为。 用户聚合功能也是通过仅考虑特定性别或年龄范围的用户生成的。            
用户聚合功能背后的直觉是 - 给定商家，如果用户访问它或平均多次购买商品，那么“双11”日商家的新买家也更有可能回来（见图5（c），5（d），6（e），6（f），7（c），7（e）和7（f））。为用户生成商家聚合功能。给定用户，他/她的商家购买日聚合特征通过首先计算用户从每个商家购买商品的天数，然后计算所有商家的平均值，标准差，最大值和中值来计算。 ，用户至少进行了一次购买。商家购买项目聚合特征是基于用户以类似方式从每个商家购买的唯一项目的数量来计算的。对于点击和添加到收藏的操作，商家操作日聚合和商家操作项目聚合功能以相同的方式计算。商家聚合功能反映了用户的习惯。如果用户平均多次购买或访问商家，则他/她可能会再次从新商家购买（参见图5（a），5（b）和7（l））                     
### 3.4最近的活动功能
Double 11功能是Double 11天的点击次数，购买次数和添加收藏数。 还计算了双11计数与总计数的比率。 对于图2中的实体，其Double 11点击计数为1，其Double 11点击率为1/12 = 0.083，其Double 11买入比率为1/2 = 0.5。 如果用户具有较高的Double 11购买比率，则用户更有可能成为一次性交易猎人。                
最新的一周功能和最新的一个月功能分别是过去一周和双11之前的最后一个月的点击次数/添加到收藏夹和购买次数。
### 3.5复杂的功能
趋势功能基于每月功能计算。 给定从5月到11月的七个月的月计数或月比率y =（y1，y2，...，y7），趋势线的斜率计算为α= n Pn i = 1（xiyi）-Pn i = 1（xi）Pn i = 1（yi）Pn i = 1（x2 i） - （Pn i = 1（xi））2，其中n = 7且xi = i。           
我们还计算了最近一个月与前几个月的偏差，并使用均值或标准差对其进行归一化，如下所示：d1 = y7-μμ，d2 = y7-μσ，其中y7是11月的特征值，μ和 σ是过去六个月中特征值的平均值和标准差。          
重复买家功能。 商家的重复买家号码被定义为从商家至少两个不同日期购买的用户数量。 对于商品，品牌和类别，重复买家编号定义为在至少两个不同日期购买商品/品牌/类别的用户数量。 商家/商品/品牌/类别的重复购买者比率被定义为商家/商品/品牌/类别的重复购买者与所有购买者（包括非重复购买者）的比率。               
商家用户的重复购买日被定义为一天，使得用户在一天之前和当天都从商家购买商品。 商家的重复日数是所有用户的重复购买日的总和。 重复购买日比率是商家的重复日数与商家的所有用户的购买天数之和的比率。
大量或高比例的重复买家表示该实体受到广泛欢迎，因此客户更有可能再次回来。我们的实验结果证实了这一点（见图7（a），7（g）和7（j））。市场份额特征衡量品牌/类别对商家的重要程度，或商家对品牌/类别的重要程度。以一个hmerchant，brandi对为例。假设NMB是来自商家的品牌购买数量，NM是来自商家的购买总数，NB是来自所有商家的品牌购买数量。类似地，我们将UMB定义为从商家购买品牌的用户数量，UM是商家的购买者总数，以及UB来自所有商家的品牌购买者数量。然后生成以下四个特征：1）商家在品牌上的市场份额= NMB / NB 2）商家在品牌上的用户份额= UMB / UB 3）品牌在商家中的市场份额= NMB / NM 4）品牌的用户份额商家= UMB / UM前两个功能衡量商家对品牌的重要性，最后两个功能衡量品牌对商家的重要程度。同样，我们可以计算hmerchant，categoryi对的市场份额特征。                         
用户 - 商家相似性特征测量用户和商家基于品牌或类别的相似程度。它们的计算基于上面定义的四个市场份额特征以及用户对品牌/类别的偏好。首选项通过用户点击，购买或添加到收藏品品牌/类别的时间或天数来衡量。假设一个商家拥有各自具有相应市场份额的品牌（0.1,0.2,0.05,0.3,0.01），并且用户购买五个品牌的次数是（0,1,2,0,2）。我们可以计算两个向量的内积，并将其作为用户与商家之间的相似度得分，即0.1×0 + 0.2×1 + 0.05×2 + 0.3×0 + 0.01×2 = 0.32。我们也可以在所有品牌上取最大值而不是总和，然后相似度得分为0.2×1 = 0.2。直观地，用户和商家越相似，用户再次从商家购买的可能性越大（参见图7（h））。 PCA功能是根据商家之间的相似性生成的。给一对商家，我们使用从他们两个购买商品的用户数作为他们的相似度得分。商家总数为4,995。因此，建立了4,995×4,995的矩阵。该矩阵非常稀疏，大多数元素等于0.简单地将其添加到特征列表中并不会明显提高分类模型的准确性，但会显着增加模型训练时间。因此，我们在相似性矩阵上应用了PCA（主成分分析）[3,12]。然后，对于每个商家，前10个主要坐标用作商家特征。  
LDA功能。 Latent Dirichlet Allocation（LDA）[4]经常用于文本挖掘，以从文档语料库中检索主题。 它将每个文档视为各种主题的混合，其中每个主题的特征在于对单词的分布。 检索到的主题分布可以作为文档的特征。 我们首先将用户模拟为文档和商家作为单词。 给定用户，我们从日志活动数据中提取用户购买物品的所有商家，并将这些商家视为用户文档的文字。 通过在这些创建的文档上应用LDA，我们为用户生成特征（即，针对商家的主题分布）。 类似地，我们将商家作为文档和用户建模为单词，并为商家生成特征（即，用户的主题分布）。 我们根据预测模型的性能将主题数设置为40。   
### 3.6  年龄/性别相关的功能
不同的用户群可能会偏向于不同类型的产品。 例如，衣服和化妆品对女性更具吸引力，而电子产品对男性更具吸引力。 因此，我们生成了一些功能来描述不同用户组中商家，品牌，类别和项目的受欢迎程度，其中用户根据其性别或年龄范围进行分组。 这些功能包括整体购买计数，每月购买计数的月度汇总，渗透功能和重复购买者功能。 仅使用特定年龄范围或特定性别的用户来计算这些功能。         
### 3.7 功能排名
我们总共生成了1364个功能。 确定重要的并删除那些用于降低培训成本的方法至关重要[13,7]。 在比赛期间，我们测试了[15,16]中描述的包装器方法和XGBoost提供的特征排序功能，我们发现所有方法产生非常相似的特征排名。 在本文中，我们通过XGBoost的功能排名功能报告结果。 除了将所有功能排在一起之外，我们还根据功能类型或所属功能对功能进行分组。 我们分别对每个组中的功能进行排名，并输出顶部功能。 我们还通过将其排除在外来评估每个功能组的重要性。                
## 4. 模型训练
在竞赛中，我们培训了各种分类模型，包括分解机[14]，Logistic回归[1]，随机森林，GBM [10]和XGBoost [6]，其中网格搜索用于选择最优参数。 XGBoost表现最好。      为了进一步提高性能，我们使用集成技术将上述单个分类器的预测混合在一起。 混合模型基本上是如下定义的加权和。              
p(u,m) =k X i=1wi × pi(u,m), (1)                   
其中p（u，m）是用户u将从商家m重复购买的最终概率，pi（u，m）是第i个单一模型预测的概率，wi是分配给商家m的权重。 第i个单一型号，k是单个型号的数量。             
我们测试了两种方法来将权重wi分配给第i个单一模型。 对于第一种方法，我们手动为单个模型分配权重，使得具有较高AUC（ROC曲线下面积）分数的单个模型获得更大的权重。 对于第二种方法，我们构建了一个分类器来学习权重。 特别地，我们为每个用户 - 商家对（u，m）生成k维特征向量，其中第i维度是第i个单个模型的概率pi（u，m）。 我们在这些特征向量上训练了一个线性模型来学习权重。              
我们的实验表明，手动分配的权重通常与本申请中的学习权重一样好，有时甚至更好。 因此，在比赛中，我们主要手动分配权重以将不同模型的预测混合在一起。 我们以递增的方式做到了 - 在每一轮中我们保持了迄今为止最好的预测，并将其与单个模型的预测相结合。 如果得到的AUC分数没有改善，我们丢弃了混合模型和单一模型，否则，我们使用混合模型更新了最佳预测。                   
图3显示了测试数据上单个模型的AUC分数。 两个线性模型，分解机器和Logistic回归，密切相关。 虽然他们的分数不是很高，但它们有助于混合模型中的总体AUC分数。 在集合算法族中，随机森林具有最差的AUC分数。 然而，我们发现随机森林模型的套袋可以显着提高分数。 XGBoost的最佳AUC分数为0.70282。 与亚军Gradient Boosting Machine相比，其改进率超过0.7％。 我们已经混合了大约20个具有各种参数设置和特征设置的单个模型，并且获得了0.70494的AUC分数，这比最佳单个模型（即，XGBoost）提高了0.21％。     
## 5. 绩效研究



